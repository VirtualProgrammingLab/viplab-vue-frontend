{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "http://virtualprogramminglab.github.io/schemas/ComputationTemplateJSONMessage.json",

    "type" : "object",

    "properties" : {
        "identifier" : {
            "type" : "string",
            "description": "uuid; the identifier of this computation template. Can be generated by the frontend launcher"
        },
        "version" : {
            "type" : "string",
            "description": "Version of the json specification; should be given for backwards compatibility"
        },
        "metadata" : {
            "type" : "object",
            "description": "Contains information for frontend",
            "properties" : {
                "displayName" : {
                    "type" : "string",
                    "description" : "Name of computation template shown in frontend"
                },
                "description" : {
                    "type" : "string",
                    "description" : "Short description; Mostly a few lines. A longer description in different formats can be put in 'elements'"
                },
                "output": {
                    "type": "object",
                    "properties": {
                        "viewer": {
                            "type": "array",
                            "items": {
                                "type": "string",
                                "enum" : ["Image", "ParaView", "ViPLabGraphics", "CSV"]
                            },
                            "additionalItems": false
                        },
                        "csv": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "id" : {
                                        "type" : "string",
                                        "description": "id; for later referencing, has to be unique"
                                    },
                                    "basename" : {
                                        "type" : "string",
                                        "description": "part of filename, that is shared by connected files"
                                    },
                                    "xlabel" : {
                                        "type": "object",
                                        "properties": {
                                            "key" : {
                                                "type" : "string",
                                                "description": "key for x-axis given in csv header"
                                            },
                                            "label" : {
                                                "type" : "string",
                                                "description": "x-axis label for diagram"
                                            },
                                            "factor" : {
                                                "type" : "number",
                                                "description": "Multiply x-values with this factor"
                                            },
                                            "format" : {
                                                "type" : "string",
                                                "description": "Format the x-axis values according to format string - https://github.com/d3/d3-format/blob/main/README.md#locale_format"
                                            }
                                        }
                                    },
                                    "plots" : {
                                        "type" : "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "key" : {
                                                    "type" : "string",
                                                    "description": "key for y-axis given in csv header"
                                                },
                                                "label" : {
                                                    "type" : "string",
                                                    "description": "y-axis label for diagram"
                                                },
                                                "factor" : {
                                                    "type" : "number",
                                                    "description": "Multiply y-values with this factor"
                                                },
                                                "format" : {
                                                    "type" : "string",
                                                    "description": "Format the y-axis values according to format string - https://github.com/d3/d3-format/blob/main/README.md#locale_format"
                                                }
                                            }
                                        }
                                    }
                                }
                            },
                            "additionalItems": false
                        },
                        "vtk": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "id" : {
                                        "type" : "string",
                                        "description": "id; for later referencing, has to be unique"
                                    },
                                    "basename" : {
                                        "type" : "string",
                                        "description": "part of filename, that is shared by connected files"
                                    }
                                }
                            },
                            "additionalItems": false
                        }
                    }
                }
            },
            "additionalProperties": false
        },
        "environment" : {
            "type" : "string",
            "enum": ["C", "C++", "Java", "Matlab", "Octave", "Container", "DuMuX", "none"],
            "default": "none",
            "description" : "Specifies the environment used for the Computation. It defines language, runtime, libraries and tools"
        },
        "files" : {
            "type" : "array",
            "description": "Array containing File objects: there has to be at least one element",
            "items" : {
                "type" : "object",
                "properties": {
                    "identifier" : {
                        "type" : "string",
                        "description": "uuid; for later referencing, has to be unique; can be autogenerated by frontend"
                    },
                    "path" : {
                        "type" : "string",
                        "pattern" : "^([A-z0-9-_+]+/?)*([A-z0-9]+[.]([A-z]+))$",
                        "description": "Absolute path to file" 
                    },
                    "metadata" : {
                        "type" : "object",
                        "properties": {
                            "syntaxHighlighting" : {
                                "type" : "string",
                                "enum" : ["abap", "abc", "actionscript", "ada", "alda",
                                          "apache_conf", "apex", "applescript", "aql", "asciidoc",
                                          "asl", "assembly_x86", "autohotkey", "batchfile",
                                          "behaviour", "c9search", "c_cpp", "cirru", "clojure",
                                          "cobol", "coffee", "coldfusion", "crystal", "csharp",
                                          "csound_document", "csound_orchestra",
                                          "csound_preprocessor", "csound_score", "csp", "css",
                                          "curly", "d", "dart", "diff", "django", "doc_comment",
                                          "dockerfile", "dot", "drools", "edifact", "eiffel", "ejs",
                                          "elixir", "elm", "erlang", "forth", "fortran", "fsharp",
                                          "fsl", "ftl", "gcode", "gherkin", "gitignore", "glsl",
                                          "gobstones", "golang", "graphqlschema", "groovy", "haml",
                                          "handlebars", "haskell", "haskell_cabal", "haxe", "hjson",
                                          "html", "html_completions", "html_elixir", "html_ruby",
                                          "ini", "io", "ion", "jack", "jade", "java", "javascript",
                                          "js_regex", "json", "json5", "jsp", "jssm", "jsx",
                                          "julia", "kotlin", "latex", "latte", "less", "liquid",
                                          "lisp", "livescript", "logiql", "logtalk", "lsl", "lua",
                                          "luapage", "lucene", "makefile", "markdown", "mask",
                                          "matching_brace_outdent", "matching_parens_outdent",
                                          "matlab", "maze", "mediawiki", "mel", "mips", "mixal",
                                          "mushcode", "mysql", "nginx", "nim", "nix", "nsis",
                                          "nunjucks", "objectivec", "ocaml", "partiql", "pascal",
                                          "perl", "pgsql", "php", "php_laravel_blade", "pig",
                                          "plain_text", "powershell", "praat", "prisma", "prolog",
                                          "properties", "protobuf", "puppet", "python", "qml", "r",
                                          "raku", "razor", "rdoc", "red", "redshift", "rhtml",
                                          "robot", "rst", "ruby", "rust", "sac", "sass", "scad",
                                          "scala", "scheme", "scrypt", "scss", "sh", "sjs", "slim",
                                          "smarty", "smithy", "snippets", "soy_template", "space",
                                          "sparql", "sql", "sqlserver", "stylus", "svg", "swift",
                                          "tcl", "terraform", "tex", "text", "textile", "toml",
                                          "tsx", "turtle", "twig", "typescript", "vala", "vbscript",
                                          "velocity", "verilog", "vhdl", "visualforce", "wollok",
                                          "xml", "yaml", "zeek"],
                                "description": "Mode of the ace editor. List can be found in on github: https://github.com/ajaxorg/ace/tree/master/src/mode. Examples: 'ini', 'c_cpp', 'matlab', 'java'. See also Ace demo: http://ajaxorg.github.io/ace-builds/kitchen-sink.html"
                            },
                            "MIMEtype" : {
                                "type": "string",
                                "description": "MIMEtype of the content. Examples: text/plain, text/html, text/uri-list, application/x-vgf, application/x-vgf3, application/x-vgfc. Descriptions: text/uri-list: links to websides to be presented in SC; application/x-vgf: generated graphics output in 'ViP graphics format'; application/x-vgf3: generated graphics output in 'ViP graphics format 3D'; application/x-vgfc: generated graphics output in 'ViP graphics format contour plot'"
                            }
                        },
                        "additionalProperties": false
                    },
                    "parts" : {
                        "type" : "array",
                        "items" : {
                            "type" : "object",
                            "properties": {
                                "identifier" : { 
                                    "type" : "string",
                                    "description": "For later referencing, has to be unique; can be autogenerated by frontend" 
                                },
                                "access" : {
                                    "type" : "string",
                                    "enum" : ["invisible", "visible", "modifiable", "template"],
                                    "description": "Defines the access level of this part for the user. See Notes on access levels for more details: https://virtualprogramminglab.github.io/documentation/viplab3.0/computation_template/#notes-on-access-levels-in-parts"
                                },
                                "metadata" : {
                                    "type" : "object",
                                    "description": "Contains information mainly for the frontend",
                                    "properties": {
                                        "name" : {
                                            "type" : "string",
                                            "description": "Additional description of this part; To be shown in the frontend"
                                        }
                                    },
                                    "additionalProperties": false
                                },
                                "content" : { 
                                    "type" : "string",
                                    "description": "Base64url encoded source code"
                                }
                            },
                            "if" : {
                                "properties" : { 
                                    "access" : { "const" : "template" } 
                                }
                            },
                            "then" : {
                                "properties" : {
                                    "parameters" : {
                                        "type" : "array",
                                        "description": "Parameters can be used to supply values at runtime to the configuration",
                                        "items" : {
                                            "type": "object"
                                        },
                                        "additionalItems": false,
                                        "minItems" : 1
                                    }
                                }
                            }, 
                            "required" : ["identifier", "access", "content"]
                        },
                        "additionalItems": false,
                        "minItems" : 1
                    }
                },
                "additionalProperties": false,
                "required" : ["identifier", "path", "parts"]
            },
            "additionalItems": false
        },
        "parameters" : {
            "type" : "array",
            "description": "Parameters can be used to supply values at runtime to the configuration",
            "items" : {
                "type": "object"
            },
            "additionalItems": false,
            "minItems" : 1
        },
        "configuration" : {
            "type" : "object",
            "description": "Optional or must (depends on environment). Environment specific configurations; Different phases can be configured like compiling, checking (for legal function calls in source code), ...",
            "properties" : {
                "compiling.sources" : {
                    "type" : "array",
                    "description": "Must for for C, C++, Java; The frontend should suggest defaults here, e.g. by suited file suffix ('.c', '.cpp', '.java'). Array of identifiers of JSON File objects. Explicit compilation (only referenced sources will be compiled)."
                },
                "compiling.compiler" : {
                    "type" : "string",
                    "description": "Must for C, C++. Compiler to be used, e.g. 'gcc'"
                },
                "compiling.flags" : {
                    "type" : "string",
                    "description": "Must for C, C++; optional for Java. CFLAGS for C/C++; compile flags for Java. Eg. 'gcc' for C/C++; '-O2' or '' for Java"
                },
                "checking.sources" : {
                    "type" : "array",
                    "description": "Must if checking should be performed. Array of identifiers of to be checked sources; given by parts[]{PART_ID}. For Matlab, Octave, C, Java; frontend should suggest all 'modifiable' and 'template' parts here"
                },
                "checking.allowedCalls" : {
                    "type" : "string",
                    "description": "Must if checking should be performed. For Matlab/Octave: allowed call names separated by WS; only idents (no braces, no func args); for Java: allowed call name expressions separated by WS. For Java semantics see Java checking semantics: https://virtualprogramminglab.github.io/documentation/viplab3.0/computation_template/#java-checking-semantics"
                },
                "checking.forbiddenCalls" : { 
                    "type" : "string",
                    "description": "Must if checking should be performed. For C: forbidden call names separated by WS, only idents (no braces, no func args); for Java: forbidden call name expressions separated by WS. For C semantics see C checking semantics (https://virtualprogramminglab.github.io/documentation/viplab3.0/computation_template/#c-checking-semantics); for Java semantics see Java checking semantics (https://virtualprogramminglab.github.io/documentation/viplab3.0/computation_template/#java-checking-semantics)"
                },
                "linking.flags" : { 
                    "type" : "string",
                    "description": "Must for C, C++; LFLAGS; e.g.: ''"
                },
                "running.stdinFilename" : { 
                    "type" : "string",
                    "description": "Must for Matlab/Octave. The file identifier that is passed to Matlab/Octave via standard-in"
                },
                "running.timelimitInSeconds" : { 
                    "type" : "integer",
                    "description": "Optional; CPU time limit. For all environments, for semantics see Notes to 'timelimitInSeconds'"
                },
                "running.commandLineArguments" : { 
                    "type" : "string",
                    "description": "Optional; For C, C++, Java: arguments given to main() function; for DuMuX, Container: additional command line args" 
                },
                "running.flags" : { 
                    "type" : "string",
                    "description": "Optional; Flags given to JVM; For Java" 
                },
                "running.mainClass" : { 
                    "type" : "string",
                    "description": "Optional (if unique) or must (if not unique). Class containing 'public static void main(String[] args) {'. For Java: 'args' may be another name. If main function is unique, its correct class should be detected automatically"
                },
                "running.executable" : { 
                    "type" : "string",
                    "description": "Must for DuMuX. Name of executable to run (as in backend file system)"
                },
                "running.entrypoint" : { 
                    "type" : "string",
                    "description": "Must for Container. Executable to run inside the container" 
                },
                "running.intermediateFilesPattern" : { 
                    "type" : "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Optional; for Container. Regex-expression in stdout which file is ready to be transferred"
                },
                "resources.image" : { 
                    "type" : "string",
                    "format": "uri",
                    "description": "Must for Container; has to be a tar. Location of the image to be executed" 
                }, 
                "resources.volume" : { 
                    "type" : "string",
                    "description": "Must for Container. Path in the container where data is placed" 
                },
                "resources.memory" : { 
                    "type" : "string",
                    "description": "Optional (64mb); for Container. Memory limit for the container"
                },
                "resources.numCPUs" : { 
                    "type" : "integer",
                    "description": "Optional; for Container. Number of CPUs for the container"
                }
            },
            "additionalProperties": false
        }
    },
    "additionalProperties": false,
    "required" : ["identifier", "environment"]
}
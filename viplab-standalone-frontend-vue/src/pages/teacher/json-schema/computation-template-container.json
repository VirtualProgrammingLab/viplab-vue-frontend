{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "http://virtualprogramminglab.github.io/schemas/ComputationTemplateJSONMessage.json",

    "type" : "object",

    "properties" : {
        "identifier" : {
            "type" : "string",
            "description": "uuid; the identifier of this computation template. Can be generated by the frontend launcher"
        },
        "version" : {
            "type" : "string",
            "description": "Version of the json specification; should be given for backwards compatibility"
        },
        "metadata" : {
            "type" : "object",
            "description": "Contains information for frontend",
            "properties" : {
                "displayName" : {
                    "type" : "string",
                    "description" : "Name of computation template shown in frontend"
                },
                "description" : {
                    "type" : "string",
                    "description" : "Short description; Mostly a few lines. A longer description in different formats can be put in 'elements'"
                },
                "output": {
                    "type": "object",
                    "properties": {
                        "viewer": {
                            "type": "array",
                            "items": {
                                "type": "string",
                                "enum" : ["Image", "ParaView", "ViPLabGraphics", "CSV"]
                            },
                            "additionalItems": false
                        },
                        "csv": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "basename" : {
                                        "type" : "string",
                                        "minLength": 1,
                                        "description": "part of filename, that is shared by connected files"
                                    },
                                    "xlabel" : {
                                        "type": "object",
                                        "properties": {
                                            "key" : {
                                                "type" : "string",
                                                "minLength": 1,
                                                "description": "key for x-axis given in csv header"
                                            },
                                            "label" : {
                                                "type" : "string",
                                                "description": "x-axis label for diagram"
                                            },
                                            "factor" : {
                                                "type" : "number",
                                                "description": "Multiply x-values with this factor"
                                            },
                                            "format" : {
                                                "type" : "string",
                                                "description": "Format the x-axis values according to format string - https://github.com/d3/d3-format/blob/main/README.md#locale_format"
                                            }
                                        },
                                        "required": ["key"]
                                    },
                                    "plots" : {
                                        "type" : "array",
                                        "items": {
                                            "type": "object",
                                            "properties": {
                                                "key" : {
                                                    "type" : "string",
                                                    "minLength": 1,
                                                    "description": "key for y-axis given in csv header"
                                                },
                                                "label" : {
                                                    "type" : "string",
                                                    "description": "y-axis label for diagram"
                                                },
                                                "factor" : {
                                                    "type" : "number",
                                                    "description": "Multiply y-values with this factor"
                                                },
                                                "format" : {
                                                    "type" : "string",
                                                    "description": "Format the y-axis values according to format string - https://github.com/d3/d3-format/blob/main/README.md#locale_format"
                                                }
                                            }
                                        },
                                        "required": ["key"]
                                    }
                                },
                                "required": ["basename"]
                            },
                            "uniqueItems": true,
                            "additionalItems": false
                        },
                        "vtk": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "basename" : {
                                        "type" : "string",
                                        "minLength": 1,
                                        "description": "part of filename, that is shared by connected files"
                                    }
                                },
                                "required": ["basename"]
                            },
                            "uniqueItems": true,
                            "additionalItems": false
                        }
                    }
                }
            },
            "additionalProperties": false
        },
        "environment" : {
            "const": "Container",
            "description" : "Specifies the environment used for the Computation. It defines language, runtime, libraries and tools"
        },
        "files" : {
            "type" : "array",
            "description": "Array containing File objects: there has to be at least one element",
            "items" : {
                "type" : "object",
                "properties": {
                    "identifier" : {
                        "type" : "string",
                        "description": "uuid; for later referencing, has to be unique; can be autogenerated by frontend"
                    },
                    "path" : {
                        "type" : "string",
                        "pattern" : "^([A-z0-9-_+]+/?)*([A-z0-9]+([.]([A-z]+))?)$",
                        "description": "Absolute path to file" 
                    },
                    "metadata" : {
                        "type" : "object",
                        "properties": {
                            "syntaxHighlighting" : {
                                "type" : "string",
                                "description": "Mode of the ace editor. List can be found in on github: https://github.com/ajaxorg/ace/tree/master/lib/ace/mode. Examples: 'ini', 'c_cpp', 'matlab', 'java'. See also Ace demo: http://ajaxorg.github.io/ace-builds/kitchen-sink.html"
                            },
                            "MIMEtype" : {
                                "type": "string",
                                "description": "MIMEtype of the content. Examples: text/plain, text/html, text/uri-list, application/x-vgf, application/x-vgf3, application/x-vgfc. Descriptions: text/uri-list: links to websides to be presented in SC; application/x-vgf: generated graphics output in 'ViP graphics format'; application/x-vgf3: generated graphics output in 'ViP graphics format 3D'; application/x-vgfc: generated graphics output in 'ViP graphics format contour plot'"
                            }
                        },
                        "additionalProperties": false
                    },
                    "parts" : {
                        "type" : "array",
                        "items" : {
                            "type" : "object",
                            "properties": {
                                "identifier" : { 
                                    "type" : "string",
                                    "description": "For later referencing, has to be unique; can be autogenerated by frontend" 
                                },
                                "access" : {
                                    "type" : "string",
                                    "enum" : ["invisible", "visible", "modifiable", "template"],
                                    "description": "Defines the access level of this part for the user. See Notes on access levels for more details: https://virtualprogramminglab.github.io/documentation/viplab3.0/computation_template/#notes-on-access-levels-in-parts"
                                },
                                "metadata" : {
                                    "type" : "object",
                                    "description": "Contains information mainly for the frontend",
                                    "properties": {
                                        "name" : {
                                            "type" : "string",
                                            "description": "Additional description of this part; To be shown in the frontend"
                                        },
                                        "description" : {
                                            "type" : "string",
                                            "description" : "Short description; Mostly a few lines. A longer description in different formats can be put in 'elements'"
                                        }
                                    },
                                    "additionalProperties": false
                                },
                                "content" : { 
                                    "type" : "string",
                                    "description": "Base64url encoded source code"
                                }
                            },
                            "if" : {
                                "properties" : { 
                                    "access" : { "const" : "template" } 
                                }
                            },
                            "then" : {
                                "properties" : {
                                    "parameters" : {
                                        "type" : "array",
                                        "description": "Parameters can be used to supply values at runtime to the configuration",
                                        "items" : {
                                            "type": "object"
                                        },
                                        "additionalItems": false,
                                        "minItems" : 1
                                    }
                                }
                            }, 
                            "required" : ["identifier", "access", "content"]
                        },
                        "additionalItems": false,
                        "minItems" : 1
                    }
                },
                "additionalProperties": false,
                "required" : ["identifier", "path", "parts"]
            },
            "additionalItems": false
        },
        "parameters" : {
            "type" : "array",
            "description": "Parameters can be used to supply values at runtime to the configuration",
            "items" : {
                "type": "object"
            },
            "additionalItems": false,
            "minItems" : 1
        },
        "configuration" : {
            "type" : "object",
            "description": "Optional or must (depends on environment). Environment specific configurations; Different phases can be configured like compiling, checking (for legal function calls in source code), ...",
            "properties" : {
                "running.timelimitInSeconds" : { 
                    "type" : "integer",
                    "description": "Optional; CPU time limit. For all environments, for semantics see Notes to 'timelimitInSeconds'"
                },
                "running.commandLineArguments" : { 
                    "type" : "string",
                    "description": "Optional; For C, C++, Java: arguments given to main() function; for DuMuX, Container: additional command line args" 
                },
                "running.entrypoint" : { 
                    "type" : "string",
                    "description": "Must for Container. Executable to run inside the container" 
                },
                "running.userId" : { 
                    "type" : "integer",
                    "description": "user id of the user that writes files inside the container. Needed to set correct permissions" 
                },
                "running.intermediateFilesPattern" : { 
                    "type" : "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Optional; for Container. Regex-expression in stdout which file is ready to be transferred"
                },
                "resources.image" : { 
                    "type" : "string",
                    "format": "uri",
                    "description": "Must for Container; has to be a tar. Location of the image to be executed" 
                }, 
                "resources.volume" : { 
                    "type" : "string",
                    "description": "Must for Container. Path in the container where data is placed" 
                },
                "resources.memory" : { 
                    "type" : "string",
                    "description": "Optional (64mb); for Container. Memory limit for the container"
                },
                "resources.numCPUs" : { 
                    "type" : "integer",
                    "description": "Optional; for Container. Number of CPUs for the container"
                },
                "resources.diskSpace" : { 
                    "type" : "integer",
                    "description": "Optional; for Container. Disk space limit for the container"
                }
            },
            "additionalProperties": false,
            "required": ["resources.image"]
        }
    },
    "additionalProperties": false,
    "required" : ["identifier", "environment", "configuration"]
}